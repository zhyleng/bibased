/*!
 * jQuery cxCalendar
 * @name jquery.cxcalendar.js
 * @version 1.3
 * @date 2014-09-23
 * @author ciaoca
 * @email ciaoca@gmail.com
 * @site https://github.com/ciaoca/cxCalendar
 * @license Released under the MIT license
 */
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){a.cxCalendar=function(){var b,c,d,l,m,e={dom:{},api:{}},f=function(a){return a&&("function"==typeof HTMLElement||"object"==typeof HTMLElement)&&a instanceof HTMLElement?!0:a&&a.nodeType&&1===a.nodeType?!0:!1},g=function(a){return a&&a.length&&("function"==typeof jQuery||"object"==typeof jQuery)&&a instanceof jQuery?!0:!1},h=function(a){return Array.isArray?Array.isArray(a):"[object Array]"===Object.prototype.toString.call(a)},i=!1,j=/^(\d+)[-.](\d+)[-.](\d+)$/,k=/^\d+$/;for(l=0,m=arguments.length;m>l;l++)g(arguments[l])?b=arguments[l]:f(arguments[l])?b=a(arguments[l]):"function"==typeof arguments[l]?d=arguments[l]:"object"==typeof arguments[l]&&(c=arguments[l]);if(!(b.length<1))return e.init=function(){var e=this;e.dom.el=b,e.settings=a.extend({},a.cxCalendar.defaults,c,{startDate:e.dom.el.data("startDate"),endDate:e.dom.el.data("endDate"),type:e.dom.el.data("type"),wday:e.dom.el.data("wday"),baseClass:e.dom.el.data("baseClass"),language:e.dom.el.data("language")}),e.dom.el.val().length&&(e.settings.date=i&&j.test(e.dom.el.val())?e.dom.el.val().replace(/[\.\-]/g,"/"):e.dom.el.val()),e.setOptions(),e.build(!0),e.api={show:function(){e.show()},hide:function(){e.hide()},getDate:function(){return e.getDate.apply(e,arguments)},setDate:function(){e.setDate.apply(e,arguments)},gotoDate:function(){e.gotoDate.apply(e,arguments)},clearDate:function(){e.clearDate()},setOptions:function(){e.setOptions.apply(e,arguments),e.build()}},"function"==typeof d&&d(e.api)},e.getMonthDay=function(a){var b=0===a%4&&0!==a%100||0===a%400?1:0;return[31,28+b,31,30,31,30,31,31,30,31,30,31]},e.formatDate=function(a,b){var c,d;if("string"==typeof a&&"undefined"!==b&&(c=new Date(b),d={},!isNaN(c.getTime())))return d.yyyy=c.getFullYear(),d.yy=d.yyyy.toString(10).slice(-2),d.m=c.getMonth()+1,d.mm=d.m<10?"0"+d.m:d.m,d.d=c.getDate(),d.dd=d.d<10?"0"+d.d:d.d,d.time=c.getTime(),d.string=c.toDateString(),a=a.replace(/STRING/g,d.string),a=a.replace(/TIME/g,d.time),a=a.replace(/YYYY/g,d.yyyy),a=a.replace(/YY/g,d.yy),a=a.replace(/MM/g,d.mm),a=a.replace(/M/g,d.m),a=a.replace(/DD/g,d.dd),a=a.replace(/D/g,d.d)},e.getLanguage=function(b){return"object"==typeof b?b:("string"==typeof b?b=b.toLowerCase():"string"==typeof navigator.language?b=navigator.language.toLowerCase():"string"==typeof navigator.browserLanguage&&(b=navigator.browserLanguage.toLowerCase()),"string"==typeof b&&"object"==typeof a.cxCalendar.languages[b]?a.cxCalendar.languages[b]:a.cxCalendar.languages.default)},e.setOptions=function(b){var d,e,f,g,i,c=this;if("object"==typeof b&&a.extend(c.settings,b),d="number"==typeof c.settings.startDate&&c.settings.startDate<=9999?new Date(c.settings.startDate,0,1):new Date(c.settings.startDate),e="number"==typeof c.settings.endDate&&c.settings.endDate<=9999?new Date(c.settings.endDate,11,31):new Date(c.settings.endDate),(isNaN(d.getTime())||isNaN(e.getTime())||d.getFullYear()>e.getFullYear())&&(d=new Date(a.cxCalendar.defaults.startDate,0,1),e=new Date(a.cxCalendar.defaults.endDate,11,31)),c.minDate={year:d.getFullYear(),month:d.getMonth()+1,time:d.getTime()},c.maxDate={year:e.getFullYear(),month:e.getMonth()+1,time:e.getTime()},f="number"==typeof c.settings.date&&c.settings.date<=9999?new Date(c.settings.date,0,1):new Date(c.settings.date),isNaN(f.getTime())&&(f=new Date),c.defDate=f.getTime()<c.minDate.time?a.extend({},c.minDate):f.getTime()>c.maxDate.time?a.extend({},c.maxDate):{year:f.getFullYear(),month:f.getMonth()+1,time:f.getTime()},c.settings.saturday=6-c.settings.wday,c.settings.sunday=7-c.settings.wday>=7?0:7-c.settings.wday,c.language=c.getLanguage(c.settings.language),h(c.language.holiday)&&c.language.holiday.length)for(c.holiday={},g=0,i=c.language.holiday.length;i>g;g++)c.holiday[c.language.holiday[g].day]=c.language.holiday[g].name;else c.holiday=!1},e.build=function(b){var d,e,c=this;for(b===!0&&(c.dom.pane=a("<div></div>",{"class":"cxcalendar"}),c.dom.paneHd=a("<div></div>",{"class":"cxcalendar_hd"}).appendTo(c.dom.pane),c.dom.paneBd=a("<div></div>",{"class":"cxcalendar_bd"}).appendTo(c.dom.pane),c.dom.paneHd.html('<a class="prev" href="javascript://" rel="prev"></a><a class="next" href="javascript://" rel="next"></a>'),c.dom.dateTxt=a("<div></div>",{"class":"intxt"}).appendTo(c.dom.paneHd),c.dom.dateSet=a("<div></div>",{"class":"inset"}).appendTo(c.dom.paneHd),c.dom.yearSet=a("<select></select>",{"class":"year"}).appendTo(c.dom.dateSet),c.dom.monthSet=a("<select></select>",{"class":"month"}).appendTo(c.dom.dateSet),c.dom.weekSet=a("<ul></ul>",{"class":"week"}).appendTo(c.dom.paneBd),c.dom.daySet=a("<ul></ul>",{"class":"days"}).appendTo(c.dom.paneBd)),d="",e=c.minDate.year;e<=c.maxDate.year;e++)d+='<option value="'+e+'">'+e+"</option>";for(c.dom.yearSet.html(d).val(c.defDate.year),d="",e=0;12>e;e++)d+='<option value="'+(e+1)+'">'+c.language.monthList[e]+"</option>";for(c.dom.monthSet.html(d).val(c.defDate.month),d="",e=0;7>e;e++)d+="<li",e===c.settings.saturday?d+=' class="sat"':e===c.settings.sunday&&(d+=' class="sun"'),d+=">",d+=e+c.settings.wday<7?c.language.weekList[e+c.settings.wday]:c.language.weekList[e+c.settings.wday-7],d+="</li>";c.dom.weekSet.html(d),"string"==typeof c.settings.baseClass&&(c.dom.pane.attr("class","cxcalendar"),c.dom.pane.addClass(c.settings.baseClass)),c.gotoDate(c.defDate.year,c.defDate.month),b===!0&&(c.dom.pane.appendTo("body"),c.dom.blockBg=a("<div></div>",{"class":"cxcalendar_lock"}).appendTo("body"),c.bindEvents())},e.bindEvents=function(){var b=this;b.dom.el.on("click",function(){b.show()}),b.dom.blockBg.on("click",function(){b.hide()}),b.dom.dateTxt.on("click",function(){b.dom.dateTxt.hide(),b.dom.dateSet.show()}),b.dom.yearSet.on("change",function(){b.gotoDate(parseInt(b.dom.yearSet.val(),10),parseInt(b.dom.monthSet.val(),10))}),b.dom.monthSet.on("change",function(){b.gotoDate(parseInt(b.dom.yearSet.val(),10),parseInt(b.dom.monthSet.val(),10))}),b.dom.pane.on("click","a",function(){var a=this.rel;switch(a){case"prev":return b.gotoDate(parseInt(b.dom.yearSet.val(),10),parseInt(b.dom.monthSet.val(),10)-1),!1;case"next":return b.gotoDate(parseInt(b.dom.yearSet.val(),10),parseInt(b.dom.monthSet.val(),10)+1),!1}}),b.dom.daySet.on("click","li",function(){var c=a(this);c.hasClass("del")||b.setDate(c.data("year"),c.data("month"),c.data("day"))})},e.rebulidMonthSelect=function(a,b){var f,c=a||1,d=b||12,e="";for(f=c;d>=f;f++)e+='<option value="'+f+'">'+this.language.monthList[f-1]+"</option>";this.dom.monthSet.html(e)},e.show=function(){var a=this,b=document.body.clientWidth,c=document.body.clientHeight,d=a.dom.pane.outerWidth(),e=a.dom.pane.outerHeight(),f=a.dom.el.offset().top,g=a.dom.el.offset().left,h=a.dom.el.outerWidth(),i=a.dom.el.outerHeight(),j=f+e+i>c?f-e:f+i,k=g+d>b?g-(d-h):g;a.dom.dateTxt.html('<span class="y">'+a.dom.yearSet.val()+'</span><span class="m">'+a.language.monthList[a.dom.monthSet.val()-1]+"</span>"),a.dom.pane.css({top:j,left:k}).show(),a.dom.blockBg.css({width:b,height:c}).show()},e.hide=function(){var a=this;a.dom.pane.hide(),a.dom.blockBg.hide(),a.dom.dateSet.hide(),a.dom.dateTxt.show()},e.getDate=function(a){var b=this,c=b.dom.el.val();return c.length&&(c="string"==typeof a?b.formatDate(a,c):b.formatDate(b.settings.type,c)),c},e.gotoDate=function(a,b){var d,e,f,h,i,j,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,c=this,g=!1;for(d="number"==typeof a&&9999>=a&&"number"==typeof b?new Date(a,b-1,1):new Date(a),e=d.getFullYear(),f=d.getMonth()+1,_theTime=d.getTime(),e<c.minDate.year||e<=c.minDate.year&&f<c.minDate.month?(e=c.minDate.year,f=c.minDate.month):(e>c.maxDate.year||e>=c.maxDate.year&&f>c.maxDate.month)&&(e=c.maxDate.year,f=c.maxDate.month),e===c.minDate.year&&e===c.maxDate.year?c.rebulidMonthSelect(c.minDate.month,c.maxDate.month):e===c.minDate.year?c.rebulidMonthSelect(c.maxDate.month):e===c.maxDate.year?c.rebulidMonthSelect(1,c.maxDate.month):c.rebulidMonthSelect(),h=f-1,i=c.getMonthDay(e),j=new Date(e,h,1),l=new Date(e,f,1),m=new Date,n=m.getFullYear(),o=m.getMonth()+1,p=m.getDate(),q=c.dom.el.val(),q.length&&(k.test(q)&&(q=parseInt(q,10)),r=new Date(q),isNaN(r.getTime())||(s=r.getFullYear(),t=r.getMonth()+1,u=r.getDate())),j.getTime()<=c.minDate.time?g=!0:l.getTime()>c.maxDate.time&&(g=!0),v=j.getDay()-c.settings.wday,0>v&&(v+=7),w=7*Math.ceil((i[h]+v)/7),D="",E=0;w>E;E++)C="",B=[],y=e,z=f,x=E-v+1,0>=x?(B.push("other"),1>=z?(y--,z=12,x=i[11]+x):(z--,x=i[h-1]+x)):x>i[h]&&(B.push("other"),z>=12?(y++,z=1,x-=i[0]):(z++,x-=i[h])),A=new Date(y,z-1,x).getTime(),"object"==typeof r&&y===s&&z===t&&x===u?B.push("selected"):y===n&&z===o&&x===p&&B.push("now"),E%7===c.settings.saturday?B.push("sat"):E%7===c.settings.sunday&&B.push("sun"),g&&(A<c.minDate.time||A>c.maxDate.time)&&B.push("del"),c.holiday?"string"==typeof c.holiday["M"+z+"-"+x]?(B.push("holiday"),C=c.holiday["M"+z+"-"+x]):"string"==typeof c.holiday["D"+y+"-"+z+"-"+x]?(B.push("holiday"),C=c.holiday["D"+y+"-"+z+"-"+x]):C=y+"-"+z+"-"+x:C=y+"-"+z+"-"+x,D+="<li",B.length&&(D+=' class="'+B.join(" ")+'"'),D+=' title="'+C+'"',D+=' data-year="'+y+'" data-month="'+z+'" data-day="'+x+'">'+x+"</li>";return c.dom.daySet.html(D),c.dom.dateTxt.html('<span class="y">'+e+'</span><span class="m">'+c.language.monthList[h]+"</span>"),c.dom.yearSet.val(e),c.dom.monthSet.val(f),this},e.setDate=function(a,b,c){var e,f,g,h,d=this;e="number"==typeof a&&9999>=a&&"number"==typeof b&&"number"==typeof c?new Date(a,b-1,c):new Date(a),isNaN(e.getTime())||(f=e.getFullYear(),g=e.getMonth()+1,_todayTime=e.getTime(),h=d.formatDate(d.settings.type,_todayTime),d.dom.el.val(h).trigger("change"),d.hide(),d.gotoDate(f,g))},e.clearDate=function(){this.dom.el.val(""),this.hide()},e.init(),this},a.cxCalendar.defaults={startDate:1950,endDate:2030,date:void 0,type:"YYYY-MM-DD",wday:0,baseClass:void 0,language:void 0},a.cxCalendar.languages={"default":{monthList:["1","2","3","4","5","6","7","8","9","10","11","12"],weekList:["日","一","二","三","四","五","六"],holiday:[]}},a.fn.cxCalendar=function(b,c){return this.each(function(){a.cxCalendar(this,b,c)}),this}});
